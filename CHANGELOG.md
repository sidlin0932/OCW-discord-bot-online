# 更新日誌 (Changelog)

## [1.3.0] - 2025-11-27 03:30:00
### 安全性更新 (Security)
- **Token 重置**: 因 Discord Bot Token 意外外洩，已重置並更新新 Token。
- **新增 `.gitignore`**: 加入 `.gitignore` 檔案以防止 `.env` 與其他敏感檔案被上傳至版控。
### 核心變更 (Core Changes) ⚠️
- **互動時間基準 (Interaction-Based Timing)**:
    - 成績計算不再依賴課程發布時間，而是以**互動發生時間**為準。
    - 即使是舊的討論串，只要本週有新留言或按讚，都會計入本週成績。
- **動態評分正規化 (Dynamic Normalization)**:
    - 若當週最高分超過 100 分，系統會自動將所有人分數依比例縮放 (最高分=100)。
    - 確保分數永遠在 0-100 之間，且反映相對表現。
- **空週處理 (Empty Week Handling)**:
    - 若該週無任何互動紀錄，將不計入 GPA 計算，`/compute` 會顯示「無活動紀錄」。

### 新增功能 (New Features)
- **累計 GPA 系統**:
    - 從 2025 第 40 週 (10/1) 開始計算累計 GPA。
    - `/compute` 與 `/leaderboard` 會顯示「本週 GPA」與「累計 GPA」。
- **全方位排行榜 (`/leaderboard`)**:
    - 支援 5 種時間範圍：本週、本月、今年、從 10/1 至今、自訂範圍。
    - 排行榜新增顯示 GPA 資訊。
- **參與度矩陣 (`/matrix`)**:
    - 預設顯示**全員**參與概況，一眼看出誰參與了哪些討論串。
- **Policy 公告系統**:
    - Bot 啟動時會自動發布成績 Policy 變更公告，並附帶「✅ 我同意」按鈕。

### 修正項目 (Fixes)
- **文件更新邏輯**: 修復因格式差異導致 README/ROADMAP 重複發送的問題 (加入空白正規化)。
- **即時更新**: 修復互動後分數未即時更新的問題。

## [1.2.3 Online] - 2025-11-24 00:41:35
### 重要變更 ⚠️
- **評分公式修改**:
    - 舊版僅依據按讚數 (👍 Reactions)
    - 新版改為綜合評分：💬 留言數 (50%) + 👍 按讚數 (30%) + 🧵 討論串參與 (20%)
    - **建議重新執行 `/compute` 更新所有週次資料**
### 改進項目
- **自動重新計算機制**:
    - Bot 啟動時會**強制重新計算所有週次**（覆蓋舊數據）。
    - 確保評分公式變更後，歷史數據自動更新，無需手動重新計算。
- **即時數據更新**:
    - 監聽訊息和按讚事件，每次有互動時立即重新計算該週數據。
    - 趨勢圖和儀表板數據永遠保持最新狀態。

## [1.2.2 Online] - 2025-11-24 00:04:40
### 新增功能
- **趨勢圖儀表板**:
    - 新增 `/trends` 頁面，使用 Chart.js 顯示學生歷史得分折線圖。
    - 支援學生多選篩選功能（可同時比較多位學生的進步曲線）。
- **歷史數據自動計算**:
    - Bot 啟動時自動計算從第 40 週（2025-10-01）到當前週的所有歷史數據。
    - 新增 30 秒延遲確保 Discord Cache 完全載入後再計算。

## [1.2.1 Online] - 2025-11-23 23:45:08
### 新增功能
- **DEPLOY_GUIDE 自動回覆**:
    - Bot 啟動時會自動在 README 論壇貼文下方以**文件附件**形式發布 `DEPLOY_GUIDE.md`。
    - 避免長文占用版面，點擊即可查看完整部署指南。
### 改進項目
- **文件完善**:
    - 新增詳細的 `DEPLOY_GUIDE.md`，包含 MongoDB 設定與環境變數說明。
    - 更新 `README.md`，明確標註 Render Root Directory 設定重點。
    - 優化 `ROADMAP.md`，聚焦實用 OCW 社群功能 (讀書會、資源庫、Office Hours)。

## [1.2.0 Online] - 2025-11-23 23:21:28
### 新增功能
- **資料庫整合 (MongoDB Integration)**:
    - 將 `bonus_points` (加分) 與 `weekly_reports` (週報) 遷移至 MongoDB Atlas。
    - 確保資料在 Bot 重啟後不會遺失 (持久化)。
- **網頁儀表板 (Web Dashboard)**:
    - 在 Bot 的 Render 網址新增了網頁介面。
    - 顯示最新的週報與加分排行榜。
- **歷史查詢指令 (History Command)**:
    - 新增 `/history <week> <year>` 指令，可從資料庫查詢過去的週報。

## [1.1.2 Online] - 2025-11-23 22:35:25
### 變更項目
- **增強自動發布 (Enhanced Auto-Publish)**:
    - `README` & `ROADMAP`: 改用 **Embeds** 顯示，並以顏色區分最新版 (綠色) 與歷史版 (灰色)。
    - `RELEASE_NOTE`: 新增版本號檢查機制，避免重複發布。
    - `CHANGELOG`: 持續支援智慧歷史補齊功能。
- **設定優化 (Configuration)**: 將 Thread IDs 改從 `.env` 讀取，提升安全性。

## [1.1.1 Online] - 2025-11-23 22:19:18
### 變更項目
- **重構 (Refactor)**: 將主程式重新命名為 `bot.py` 以利部署。
- **Render 設定**: 更新 `render.yaml` 以執行 `python bot.py`。
- **文件**: 新增 `ROADMAP.md` 並更新 `README.md`。

## [1.1.0 Online] - 2025-11-23 17:49:20
### 新增功能
- **月報與自訂範圍**: `/compute` 現在支援 `month` (如 `month:11`) 與自訂日期範圍 (`start_date`, `end_date`)。
- **日期範圍顯示**: 所有統計指令 (`leaderboard`, `matrix` 等) 現在都會明確顯示計算的日期範圍 (例如 "2025-11-01 ~ 2025-11-30")。
- **自動發布文件**: Bot 啟動時會自動將 `README`, `ROADMAP`, `CHANGELOG`, `RELEASE_NOTE` 更新至對應的論壇貼文。

## [1.0 Online] - 2025-11-23 15:12:49
### 新增功能
- **24/7 在線支援**: 整合 Flask 網頁伺服器 (`keep_alive.py`) 以支援雲端託管。
- **安全性**: 將敏感資料 (Token, IDs) 遷移至環境變數。
- **自動化**: 新增 `weekly_report_task`，每週一 00:00 (UTC+8) 自動產生報告。
- **時區**: 將所有時間標準化為台灣時間 (UTC+8)。
- **部署設定**: 新增 `render.yaml` 與 `requirements.txt` 供 Render 部署使用。

## [1.3] - 2025-11-23 04:09:36
### 變更項目
- **動態成員獲取**: 將硬編碼的 `USER_IDS` 改為自動獲取所有伺服器成員。
- **週次計算**: 更新 `/compute` 接受週數並預設為當前週 (週一至週日)。

## [1.2] - 2025-11-21 14:18:25
### 修正項目
- **Slash Commands**: 修復 `trycompute` 等指令的註冊問題。
- **權限**: 為老師專用指令新增權限檢查。

## [1.1] - 2025-11-09 12:00:00
- 初始版本，包含基本的追蹤與評分邏輯。
